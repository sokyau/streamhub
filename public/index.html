<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamHub - Control de Transmisiones</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                        <path d="M15 10L19.5528 7.72361C20.2177 7.39116 21 7.87465 21 8.61803V15.382C21 16.1253 20.2177 16.6088 19.5528 16.2764L15 14M5 18H13C14.1046 18 15 17.1046 15 16V8C15 6.89543 14.1046 6 13 6H5C3.89543 6 3 6.89543 3 8V16C3 17.1046 3.89543 18 5 18Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <h1>StreamHub</h1>
                </div>
                <nav class="header-nav">
                    <button class="btn btn-secondary" onclick="showModal('dropboxModal')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L7 9.5L12 7L17 9.5L22 7L12 2Z" fill="currentColor"/>
                            <path d="M2 17L7 14.5L12 17L17 14.5L22 17L12 22L2 17Z" fill="currentColor" opacity="0.6"/>
                            <path d="M7 9.5L2 12L7 14.5L12 12L7 9.5Z" fill="currentColor"/>
                            <path d="M17 9.5L12 12L17 14.5L22 12L17 9.5Z" fill="currentColor"/>
                        </svg>
                        Importar de Dropbox
                    </button>
                    <button class="btn btn-secondary" onclick="showPlatformModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Agregar Plataforma
                    </button>
                    <button class="btn btn-icon" onclick="showSettingsModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M19.4 15C19.1277 15.6171 19.2583 16.3378 19.73 16.82L19.79 16.88C20.1656 17.2551 20.3766 17.7642 20.3766 18.295C20.3766 18.8258 20.1656 19.3349 19.79 19.71C19.4149 20.0856 18.9058 20.2966 18.375 20.2966C17.8442 20.2966 17.3351 20.0856 16.96 19.71L16.9 19.65C16.4178 19.1783 15.6971 19.0477 15.08 19.32C14.4755 19.5791 14.0826 20.1724 14.08 20.83V21C14.08 22.1046 13.1846 23 12.08 23H12C10.8954 23 10 22.1046 10 21V20.91C9.99734 20.2327 9.58273 19.6277 9 19.37C8.38291 19.0977 7.66219 19.2283 7.18 19.7L7.12 19.76C6.74493 20.1356 6.23582 20.3466 5.705 20.3466C5.17418 20.3466 4.66507 20.1356 4.29 19.76C3.91445 19.3849 3.70343 18.8758 3.70343 18.345C3.70343 17.8142 3.91445 17.3051 4.29 16.93L4.35 16.87C4.82167 16.3878 4.95227 15.6671 4.68 15.05C4.42093 14.4455 3.82764 14.0526 3.17 14.05H3C1.89543 14.05 1 13.1546 1 12.05V12C1 10.8954 1.89543 10 3 10H3.09C3.76734 9.99734 4.37228 9.58273 4.63 9C4.90227 8.38291 4.77167 7.66219 4.3 7.18L4.24 7.12C3.86445 6.74493 3.65343 6.23582 3.65343 5.705C3.65343 5.17418 3.86445 4.66507 4.24 4.29C4.61507 3.91445 5.12418 3.70343 5.655 3.70343C6.18582 3.70343 6.69493 3.91445 7.07 4.29L7.13 4.35C7.61219 4.82167 8.33291 4.95227 8.95 4.68H9C9.60448 4.42093 10.0 3.82764 10 3.17V3C10 1.89543 10.8954 1 12 1C13.1046 1 14 1.89543 14 3V3.09C14 3.74764 14.3955 4.34093 15 4.6C15.6171 4.87227 16.3378 4.74167 16.82 4.27L16.88 4.21C17.2551 3.83445 17.7642 3.62343 18.295 3.62343C18.8258 3.62343 19.3349 3.83445 19.71 4.21C20.0856 4.58507 20.2966 5.09418 20.2966 5.625C20.2966 6.15582 20.0856 6.66493 19.71 7.04L19.65 7.1C19.1783 7.58219 19.0477 8.30291 19.32 8.92V9C19.5791 9.60448 20.1724 10 20.83 10H21C22.1046 10 23 10.8954 23 12C23 13.1046 22.1046 14 21 14H20.91C20.2524 14 19.6591 14.3955 19.4 15Z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                </nav>
            </div>
        </header>

        <main class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="tab" onclick="switchTab('schedule')">Programación</button>
            </div>

            <div id="dashboard-tab" class="tab-content active">
                <section class="content-section">
                    <div class="section-header">
                        <h2>Transmisiones Activas</h2>
                        <span class="badge" id="activeCount">0</span>
                    </div>
                    <div id="activeStreams" class="streams-list">
                        <p style="text-align: center; color: var(--text-secondary);">
                            No hay transmisiones activas
                        </p>
                    </div>
                </section>

                <section id="downloadsSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2>Descargas Activas</h2>
                    </div>
                    <div id="activeDownloads"></div>
                </section>

                <section class="content-section">
                    <div class="section-header">
                        <h2>Videos Disponibles</h2>
                        <span class="badge" id="videoCount">0</span>
                    </div>
                    <div id="videosList" class="videos-grid"></div>
                </section>
            </div>

            <div id="schedule-tab" class="tab-content">
                <section class="content-section">
                    <div class="section-header">
                        <h2>Transmisiones Programadas</h2>
                        <button class="btn btn-primary" onclick="showScheduleModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Nueva Programación
                        </button>
                    </div>
                    <div id="schedulesList" class="schedules-list"></div>
                </section>
            </div>
        </main>
    </div>

    <div id="streamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Transmitir Video</h3>
                <button class="close-btn" onclick="closeModal('streamModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Video: <strong id="streamVideoName"></strong></p>
                
                <div class="loop-controls-section"></div>
                
                <h4>Selecciona las plataformas:</h4>
                <div id="platformsList" class="platforms-list"></div>
                
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="startStreaming()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                        </svg>
                        Iniciar Transmisión
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('streamModal')">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="platformModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Plataforma</h3>
                <button class="close-btn" onclick="closeModal('platformModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="platformForm">
                    <div class="form-group">
                        <label for="platformName">Nombre de la Plataforma</label>
                        <input type="text" id="platformName" required placeholder="Mi Stream">
                    </div>
                    
                    <div class="form-group">
                        <label for="platformType">Tipo de Plataforma</label>
                        <select id="platformType" required onchange="updatePlatformHelp()">
                            <option value="">-- Selecciona --</option>
                            <option value="youtube">YouTube</option>
                            <option value="facebook">Facebook</option>
                            <option value="twitch">Twitch</option>
                            <option value="custom">Personalizada</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="rtmpUrl">URL RTMP</label>
                        <input type="text" id="rtmpUrl" required placeholder="rtmp://...">
                        <small id="rtmpHelp">Selecciona un tipo de plataforma para ver la URL recomendada</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="streamKey">Clave de Transmisión</label>
                        <input type="password" id="streamKey" required placeholder="xxxx-xxxx-xxxx-xxxx">
                        <small>Encuentra tu clave de transmisión en la configuración de tu plataforma</small>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Guardar Plataforma</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('platformModal')">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="dropboxModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Importar de Dropbox</h3>
                <button class="close-btn" onclick="closeModal('dropboxModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="dropboxUrl">URL de Dropbox</label>
                    <input type="url" id="dropboxUrl" placeholder="https://www.dropbox.com/...">
                    <small>Pega el enlace compartido de Dropbox del video</small>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="startDropboxDownload()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15M7 10L12 15M12 15L17 10M12 15V3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Descargar
                    </button>
                    <button class="btn btn-secondary" onclick="showDropboxAPIConfig()">
                        Configurar API
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('dropboxModal')">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="downloadProgressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Descargando Video</h3>
            </div>
            <div class="modal-body">
                <div class="download-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="downloadProgressFill"></div>
                    </div>
                    <div class="progress-info">
                        <span id="downloadProgress">0%</span>
                        <span id="downloadSpeed">--</span>
                    </div>
                </div>
                <p class="download-details">
                    <span id="downloadStatus">Preparando descarga...</span><br>
                    <span id="downloadSize">-- / --</span>
                </p>
                
                <div class="modal-actions">
                    <button class="btn btn-danger" onclick="cancelDownload()">Cancelar Descarga</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configuración</h3>
                <button class="close-btn" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <h4>API de Dropbox</h4>
                <div id="dropboxAPIStatus" class="api-status"></div>
                
                <form id="dropboxAPIForm">
                    <div class="form-group">
                        <label for="dropboxAccessToken">Access Token</label>
                        <input type="password" id="dropboxAccessToken" required>
                        <small>Obtén tu token desde la consola de desarrolladores de Dropbox</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="dropboxRefreshToken">Refresh Token (Opcional)</label>
                        <input type="password" id="dropboxRefreshToken">
                        <small>Para mantener el acceso permanente</small>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Guardar Configuración</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('settingsModal')">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Programar Transmisión</h3>
                <button class="close-btn" onclick="closeModal('scheduleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="scheduleVideo">Video</label>
                        <select id="scheduleVideo" required>
                            <option value="">-- Selecciona un video --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Días de la Semana</label>
                        <div class="days-selector">
                            <label class="day-checkbox">
                                <input type="checkbox" value="0">
                                <span>Dom</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="1">
                                <span>Lun</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="2">
                                <span>Mar</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="3">
                                <span>Mié</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="4">
                                <span>Jue</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="5">
                                <span>Vie</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="6">
                                <span>Sáb</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="scheduleTime">Hora de Inicio</label>
                        <input type="time" id="scheduleTime" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Plataformas</label>
                        <div id="schedulePlatformsList" class="platforms-list"></div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Programar</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('scheduleModal')">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="notifications" class="notifications-container"></div>

    <script src="app.js"></script>
    <script src="loop-ui.js"></script>
</body>
</html>
